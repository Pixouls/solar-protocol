FROM docker.io/library/python:3.10-slim

RUN apt-get --quiet update && apt-get --quiet upgrade --yes && apt-get --quiet install \
  build-essential libcairo2 libffi-dev \
  libjpeg-dev zlib1g zlib1g-dev --yes
ENV TERM=screen-256color

WORKDIR /solar-protocol
RUN python -m venv /solar-protocol/venv
ENV PATH="/solar-protocol/venv/bin:$PATH"
RUN pip install --quiet --no-cache-dir wheel
COPY requirements.txt .
RUN pip install --quiet --no-cache-dir --requirement requirements.txt

WORKDIR /solar-protocol/venv
COPY . .

CMD python run.py
