 <!DOCTYPE html>
<html>
<head>
<title>Solar Protocol</title>
</head>
<body>

<h1>Admin Console</h1>

<div id="server list"><h2>Servers:</h2></div>

<script>
	//make this dynamic at some point
	let tempIPList = ["74.73.93.241","67.85.62.144","108.29.41.133"];
	
	//get the most recent line of charge controller data
	let toGet = "0";

	for (let i = 0; i < tempIPList.length; i++){
		//pingServer(tempIPList[i], populate);
		makeGet(tempIPList[i], toGet, populate);
	}

	function makeGet(dst, getThis, callback) {
		let requestURL = "http://" + dst + "/api/v1/api.php?line="+getThis;

		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				callback(this.responseText, dst);
			} else if (this.readyState == 4) {
				callback(this.statusText, dst);
			}
		};
		xhttp.open("GET", requestURL, true);
		xhttp.send();
	}

	function populate(dataToDisplay, dst) {

		const sList = document.getElementById('server list');

		//server header
		const serverH3 = document.createElement('h3');
		serverH3.textContent = 'Server: ';
		//make it a link
		const serverLink = document.createElement('a');
		serverLink.href = "http://"+dst;
		serverLink.target = "_blank"; //open in new tab

		const serverLinkContent = document.createTextNode(dst);
		serverLink.appendChild(serverLinkContent);

		serverH3.appendChild(serverLink);
		//server info
		const serverInfo = document.createElement('p');

		let displayThis = toJSON(dataToDisplay);

		if(displayThis != false){
			serverInfo.textContent =  JSON.stringify(displayThis);//put this into a table in the future
		} else {
			serverInfo.textContent =  "no response or invalid format";
		}


		serverH3.appendChild(serverInfo);
		sList.appendChild(serverH3);
	}

	function addActions(){
		//ping the servers
	}

	//check data is formatted correctly
	function toJSON(aString){
		//check that it can be converted to JSON

		try{
			let newJSON = JSON.parse(aString);
			
			console.log(newJSON);
			return newJSON;
		} catch (e){
			console.log(aString);
			return false;
		}
	}
</script>

</body>
</html> 