 <!DOCTYPE html>
<html>
<head>
<title>Solar Protocol</title>
</head>
<body>

<h1>Admin Console</h1>

<div id="server list"><h2>Active Servers:</h2></div>

<script>
	let tempIPList = ["74.73.93.241","67.85.62.144","108.29.41.133"];
	
	for (let i = 0; i < tempIPList.length; i++){
		pingServer(tempIPList[i], populate)
	}
	
	//either enable cross cors request or add to API
	function pingServer(dst, callback){
	//get voltage & time stamp
		let infoNeeded = "PV-voltage";
		let requestURL = "http://" + dst + "/api/v1/api.php?value="+infoNeeded;
		console.log(requestURL);
		
		makeGet(requestURL,callback);
	
	}

	function makeGet(dst, callback) {
	  let xhttp = new XMLHttpRequest();
	  xhttp.onreadystatechange = function() {
	    if (this.readyState == 4 && this.status == 200) {
	      callback(this.responseText, dst);
	    }
	  };
	  xhttp.open("GET", dst, true);
	  xhttp.send();
	}

	function populate(dataToDisplay, dst) {
		console.log(dataToDisplay);
		const sList = document.getElementById('server list');

		//server header
		const serverH3 = document.createElement('h3');
		serverH3.textContent = 'Server: ';
		//make it a link
		const serverLink = document.createElement('a');
		serverLink.href = "http://"+dst;
		serverLink.target = "_blank"; //open in new tab

		const serverLinkContent = document.createTextNode(dst);
		serverLink.appendChild(serverLinkContent);

		serverH3.appendChild(serverLink);
		//server info
		const serverInfo = document.createElement('p');
		serverInfo.textContent =  'Most recent data: ' + dataToDisplay;


		serverH3.appendChild(serverInfo);
		sList.appendChild(serverH3);
	}

	function addActions(){
		//ping the servers
	}

</script>

</body>
</html> 